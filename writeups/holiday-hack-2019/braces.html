<!DOCTYPE html5>
<html>
	<head>
		<title>braces | Holiday Hack 2019</title>
		<link rel="stylesheet" href="/css/common.css">
		<link rel="stylesheet" href="/css/writeup.css">
		<link rel="stylesheet" href="/css/pygments.css">
		<link rel="stylesheet" href="https://unpkg.com/normalize.css@8.0.1/normalize.css">
		
		<meta charset="utf-8" />
	</head>
	<body>
		<main>
			<h1>Smart Braces</h1>
<p>There's a lot of resources for learning <code>iptables</code>, <a href="https://www.howtogeek.com/177621/the-beginners-guide-to-iptables-the-linux-firewall/">this one</a> covers a lot of the common things.</p>
<p>First, we clear out all the existing rules:</p>
<div class="codehilite"><pre><span></span><span class="err">sudo iptables -F</span>
</pre></div>


<p>Then we make sure we DROP everything by default for all chains:</p>
<div class="codehilite"><pre><span></span><span class="err">sudo iptables -P FORWARD DROP</span>
<span class="err">sudo iptables -P INPUT DROP</span>
<span class="err">sudo iptables -P OUTPUT DROP</span>
</pre></div>


<p>We need to accept input and output for connections we've already established, which saves us a few rules and gives most packets an early out. <code>-m state</code> includes the connection state module, then <code>--state</code> filters by connection state.</p>
<div class="codehilite"><pre><span></span><span class="err">sudo iptables -A INPUT -m state --state ESTABLISHED,RELATED -j ACCEPT</span>
<span class="err">sudo iptables -A OUTPUT -m state --state ESTABLISHED,RELATED -j ACCEPT</span>
</pre></div>


<p>Now we accept all incoming traffic from the specified IP and port. Since this is traffic coming in, the destination is the port we're recieving it on.</p>
<div class="codehilite"><pre><span></span><span class="err">sudo iptables -A INPUT -p tcp -s 172.19.0.225 --dport 22 -m state --state NEW,ESTABLISHED -j ACCEPT</span>
</pre></div>


<p>Now we allow incoming connections to ports 21 and 80.</p>
<div class="codehilite"><pre><span></span><span class="err">sudo iptables -A INPUT -p tcp --dport 21 -m state --state NEW,ESTABLISHED -j ACCEPT</span>
<span class="err">sudo iptables -A INPUT -p tcp --dport 80 -m state --state NEW,ESTABLISHED -j ACCEPT</span>
</pre></div>


<p>Finally, we allow any packets that are going out to port 80.</p>
<div class="codehilite"><pre><span></span><span class="err">sudo iptables -A OUTPUT -p tcp --dport 80 -m state --state NEW,ESTABLISHED -j ACCEPT</span>
</pre></div>


<p>As a final note, we should also allow anything on the <code>lo</code> interface, so <code>localhost</code> still works.</p>
<div class="codehilite"><pre><span></span><span class="err">sudo iptables -A INPUT -i lo -j ACCEPT</span>
</pre></div>
		</main>

		<footer>
			<div class="links">
				<div>
					<a aria-label="Back" href="index.html">
						<span class="iconify" data-icon="fa:arrow-left"></span>
					</a>
				</div>
				<div>
			</div>
		</footer>

		<script src="https://code.iconify.design/1/1.0.3/iconify.min.js"></script>
	</body>
</html>