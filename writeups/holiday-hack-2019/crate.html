<!DOCTYPE html5>
<html>
	<head>
		<title>crate | Holiday Hack 2019</title>
		<link rel="stylesheet" href="/css/common.css">
		<link rel="stylesheet" href="/css/writeup.css">
		<link rel="stylesheet" href="/css/pygments.css">
		<link rel="stylesheet" href="https://unpkg.com/normalize.css@8.0.1/normalize.css">
		
		<meta charset="utf-8" />
	</head>
	<body>
		<main>
			<h1>Crate</h1>
<p>This challenge is 10 locks where you use the devtools to find the 8-digit code for each lock. Every code changes each time.</p>
<h2>Lock 1</h2>
<p>Scroll up in the console and you'll see the code in a green square</p>
<h2>Lock 2</h2>
<p>Hit print and look at the print preview. If you look closer at the code, there's a stylesheet <code>print.css</code> that just makes <code>.libra strong</code> visible with a print media query. So we can get the code for this lock with:</p>
<div class="codehilite"><pre><span></span><span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s1">&#39;.libra strong&#39;</span><span class="p">).</span><span class="nx">innerText</span>
</pre></div>


<h2>Lock 3</h2>
<p>Fetch is a clue that the <code>fetch</code> API was used, which is a nicer way to do AJAX that isn't really ugly. If you scroll through the network tab (and filter by XHR), you'll see an image that's just the white code on a black background.</p>
<h2>Lock 4</h2>
<p>If you look in the local storage for the site you can see an entry with no key. The value is the code for this lock.</p>
<h2>Lock 5</h2>
<p>If you look in the <code>&lt;title&gt;</code> block you see the normal title, <code>&amp;emsp;</code> a bunch of times, then the code for this lock.</p>
<p>You can do this with JS as well:</p>
<div class="codehilite"><pre><span></span><span class="c1">// Last 8 characters of &lt;title&gt; block</span>
<span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">).</span><span class="nx">innerText</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="o">-</span><span class="mi">8</span><span class="p">)</span>
</pre></div>


<h2>Lock 6</h2>
<p>If you look on the <code>.hologram</code> element you can disable the <code>perspective</code> style to see the letters in the correct order.</p>
<h2>Lock 7</h2>
<p>If you look at the <code>&lt;head&gt;</code> element you can see a <code>style</code> element with only one rule, which specifies:</p>
<div class="codehilite"><pre><span></span><span class="nt">font-family</span><span class="o">:</span> <span class="s1">&#39;AAAAAAAA&#39;</span><span class="o">,</span> <span class="s1">&#39;Beth Ellen&#39;</span><span class="o">,</span> <span class="nt">cursive</span><span class="o">;</span>
</pre></div>


<p>The first font mentioned is the code.</p>
<h2>Lock 8</h2>
<p>If you look at the event listeners for the <code>span.egg</code> you see a <code>spoil</code> event. If you follow this to the JS and prettify it, it sets <code>window['CODE'] = 'sad'</code>.</p>
<h2>Lock 9</h2>
<p>In the instructions for this lock, there's a bunch of invisible divs with the class <code>chakra</code>. You can use your browser's devtools to set <code>:active</code> for each of those elements, which reveals the code.</p>
<h2>Lock 10</h2>
<p>If you set the <code>.cover</code> to <code>display:none</code> then you'll see the code printed on the lower left of the circuit board. If you try to submit however, you'll get an error in your console saying 'Missing macaroni!'.</p>
<p>This is thrown from a try catch block wrapping this:</p>
<div class="codehilite"><pre><span></span><span class="kr">const</span> <span class="nx">_0x2cb37a</span> <span class="o">=</span> <span class="nb">document</span><span class="p">[</span><span class="nx">_0x5a05</span><span class="p">(</span><span class="s1">&#39;0x33&#39;</span><span class="p">)](</span><span class="s1">&#39;\x2e\x6c\x6f\x63\x6b\x73\x20\x3e\x20\x6c\x69\x20\x3e\x20\x2e\x6c\x6f\x63\x6b\x2e\x63\x31\x30\x20\x3e\x20\x2e\x63\x6f\x6d\x70\x6f\x6e\x65\x6e\x74\x2e\x6d\x61\x63\x61\x72\x6f\x6e\x69&#39;</span><span class="p">);</span>
<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">_0x2cb37a</span><span class="p">)</span>
    <span class="k">throw</span> <span class="nb">Error</span><span class="p">(</span><span class="s1">&#39;\x4d\x69\x73\x73\x69\x6e\x67\x20\x6d\x61\x63\x61\x72\x6f\x6e\x69\x21&#39;</span><span class="p">);</span>
<span class="nx">_0x2cb37a</span><span class="p">[</span><span class="s1">&#39;\x61\x74\x74\x72\x69\x62\x75\x74\x65\x73&#39;</span><span class="p">][</span><span class="s1">&#39;\x64\x61\x74\x61\x2d\x63\x6f\x64\x65&#39;</span><span class="p">][</span><span class="nx">_0x5a05</span><span class="p">(</span><span class="s1">&#39;0x30&#39;</span><span class="p">)];</span>
<span class="kr">const</span> <span class="nx">_0x23999f</span> <span class="o">=</span> <span class="nb">document</span><span class="p">[</span><span class="nx">_0x5a05</span><span class="p">(</span><span class="s1">&#39;0x33&#39;</span><span class="p">)](</span><span class="nx">_0x5a05</span><span class="p">(</span><span class="s1">&#39;0x5d&#39;</span><span class="p">));</span>
<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">_0x23999f</span><span class="p">)</span>
    <span class="k">throw</span> <span class="nb">Error</span><span class="p">(</span><span class="nx">_0x5a05</span><span class="p">(</span><span class="s1">&#39;0x5e&#39;</span><span class="p">));</span>
<span class="nx">_0x23999f</span><span class="p">[</span><span class="nx">_0x5a05</span><span class="p">(</span><span class="s1">&#39;0x2e&#39;</span><span class="p">)][</span><span class="nx">_0x5a05</span><span class="p">(</span><span class="s1">&#39;0x5f&#39;</span><span class="p">)][</span><span class="nx">_0x5a05</span><span class="p">(</span><span class="s1">&#39;0x30&#39;</span><span class="p">)];</span>
<span class="kr">const</span> <span class="nx">_0x2bbe7a</span> <span class="o">=</span> <span class="nb">document</span><span class="p">[</span><span class="nx">_0x5a05</span><span class="p">(</span><span class="s1">&#39;0x33&#39;</span><span class="p">)](</span><span class="nx">_0x5a05</span><span class="p">(</span><span class="s1">&#39;0x60&#39;</span><span class="p">));</span>
<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">_0x2bbe7a</span><span class="p">)</span>
    <span class="k">throw</span> <span class="nb">Error</span><span class="p">(</span><span class="nx">_0x5a05</span><span class="p">(</span><span class="s1">&#39;0x61&#39;</span><span class="p">));</span>
<span class="nx">_0x2bbe7a</span><span class="p">[</span><span class="nx">_0x5a05</span><span class="p">(</span><span class="s1">&#39;0x2e&#39;</span><span class="p">)][</span><span class="nx">_0x5a05</span><span class="p">(</span><span class="s1">&#39;0x5f&#39;</span><span class="p">)][</span><span class="nx">_0x5a05</span><span class="p">(</span><span class="s1">&#39;0x30&#39;</span><span class="p">)];</span>
<span class="nx">_0x19a27e</span><span class="p">(</span><span class="nx">_0x385f00</span><span class="p">,</span> <span class="p">{</span>
    <span class="s1">&#39;\x69\x64&#39;</span><span class="o">:</span> <span class="nx">_0x385f00</span><span class="p">,</span>
    <span class="s1">&#39;\x63\x6f\x64\x65&#39;</span><span class="o">:</span> <span class="nx">_0x281576</span><span class="p">[</span><span class="nx">_0x5a05</span><span class="p">(</span><span class="s1">&#39;0x30&#39;</span><span class="p">)]</span>
<span class="p">});</span>
</pre></div>


<p>You can use your browser's debugger to break at the top line of this and evaluate the obfuscated parts of this code in the console. Here's the code cleaned up a bit:</p>
<div class="codehilite"><pre><span></span><span class="kr">const</span> <span class="nx">a</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s2">&quot;.locks &gt; li &gt; .lock.c10 &gt; .component.macaroni&quot;</span><span class="p">);</span>
<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">a</span><span class="p">)</span>
    <span class="k">throw</span> <span class="nb">Error</span><span class="p">(</span><span class="s1">&#39;Missing macaroni!&#39;</span><span class="p">);</span>
<span class="nx">a</span><span class="p">.</span><span class="nx">attributes</span><span class="p">[</span><span class="s1">&#39;data-code&#39;</span><span class="p">][</span><span class="s1">&#39;value&#39;</span><span class="p">];</span>
<span class="kr">const</span> <span class="nx">b</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s2">&quot;.locks &gt; li &gt; .lock.c10 &gt; .component.swab&quot;</span><span class="p">);</span>
<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">b</span><span class="p">)</span>
    <span class="k">throw</span> <span class="nb">Error</span><span class="p">(</span><span class="s2">&quot;Missing cotton swab!&quot;</span><span class="p">);</span>
<span class="nx">b</span><span class="p">.</span><span class="nx">attributes</span><span class="p">[</span><span class="s1">&#39;data-code&#39;</span><span class="p">][</span><span class="s1">&#39;value&#39;</span><span class="p">];</span>
<span class="kr">const</span> <span class="nx">c</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s2">&quot;.locks &gt; li &gt; .lock.c10 &gt; .component.gnome&quot;</span><span class="p">);</span>
<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">c</span><span class="p">)</span>
    <span class="k">throw</span> <span class="nb">Error</span><span class="p">(</span><span class="nx">_0x5a05</span><span class="p">(</span><span class="s1">&#39;0x61&#39;</span><span class="p">));</span>
<span class="nx">c</span><span class="p">.</span><span class="nx">attributes</span><span class="p">[</span><span class="s1">&#39;data-code&#39;</span><span class="p">][</span><span class="s1">&#39;value&#39;</span><span class="p">];</span>

<span class="nx">_0x19a27e</span><span class="p">(</span><span class="nx">_0x385f00</span><span class="p">,</span> <span class="p">{</span>
    <span class="s1">&#39;\x69\x64&#39;</span><span class="o">:</span> <span class="nx">_0x385f00</span><span class="p">,</span>
    <span class="s1">&#39;\x63\x6f\x64\x65&#39;</span><span class="o">:</span> <span class="nx">_0x281576</span><span class="p">[</span><span class="nx">_0x5a05</span><span class="p">(</span><span class="s1">&#39;0x30&#39;</span><span class="p">)]</span>
<span class="p">});</span>
</pre></div>


<p>So directly under <code>.lock.c10</code>, we need to have 3 components: <code>macaroni</code>, <code>swab</code> and <code>gnome</code>, and they all need to have a <code>data-code</code> attribute. We can add those into the html and submit to unlock the vault.</p>
<p>The villain is the tooth fairy.</p>
		</main>

		<footer>
			<div class="links">
				<div>
					<a aria-label="Back" href="index.html">
						<span class="iconify" data-icon="fa:arrow-left"></span>
					</a>
				</div>
				<div>
			</div>
		</footer>

		<script src="https://code.iconify.design/1/1.0.3/iconify.min.js"></script>
	</body>
</html>